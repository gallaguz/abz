---
- name: "[ {{ service_name }} ]: Configuring secret"
  block:
    - name: "[ {{ service_name }} ]: Create secret"
      include_tasks: "secret_create.yaml"
  tags: "{{ service_name }}"

  rescue:
    - name: "[ {{ service_name }} ]: Removing service"
      community.docker.docker_swarm_service:
        name: "{{ service_name }}"
        state: absent

    - name: "[ {{ service_name }} ]: Create secret"
      include_tasks: "secret_create.yaml"
